package org.opentestsystem.rdw.migrate.common;


import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;

import java.time.Instant;

/**
 * Migrate job parameters
 */
public class MigrateJobParameters extends JobParameters {

    static public final String JobIdentifier = "jobIdentifier";
    static public final String FirstAt = "firstAt";
    static public final String LastAt = "lastAt";
    static public final String MigrateCodes = "migrateCodes";
    static public final String BatchSize = "size";

    public MigrateJobParameters(final Instant firstAt, final Instant lastAt, final boolean migrateCodes, final int batchSize) {
        super(new JobParametersBuilder()
                .addLong(JobIdentifier, System.currentTimeMillis())
                // As defined in the {@link JobParameter}, only the following types can be parameters: String, Long,
                // Date, and Double. And Date/Long doesn't have enough precision ...
                .addString(FirstAt, firstAt.toString(), false)
                .addString(LastAt, lastAt.toString(), false)
                .addLong(MigrateCodes, migrateCodes ? 1L : 0, false)
                .addLong(BatchSize, (long) batchSize)
                .toJobParameters().getParameters());
    }

    public Instant getFirstAt() {
        return Instant.parse(getString(FirstAt));
    }

    public Instant getLastAt() {
        return Instant.parse(getString(LastAt));
    }

    public boolean getMigrateCodes() {
        return getLong(MigrateCodes) == 1;
    }

    public int getBatchSize() {
        return getLong(BatchSize).intValue();
    }
}

