package org.opentestsystem.rdw.migrate.common;


import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;

import java.time.Instant;

/**
 * Migrate job parameters
 */
public class MigrateJobParameters extends JobParameters {

    static final String JobIdentifier = "jobIdentifier";
    private static final String FirstAt = "firstAt";
    private static final String LastAt = "lastAt";
    private static final String MigrateCodes = "migrateCodes";
    private static final String MigrateEmbargo = "migrateEmbargo";
    private static final String BatchSize = "size";

    public MigrateJobParameters(final MigrateImportValues values) {
        this(values.getFirstAt(), values.getLastAt(), values.migrateCodes(), values.migrateEmbargo(), values.getImportCount());
    }

    public MigrateJobParameters(final Instant firstAt,
                                final Instant lastAt,
                                final boolean migrateCodes,
                                final boolean migrateEmbargo,
                                final int batchSize) {
        super(new JobParametersBuilder()
                .addLong(JobIdentifier, System.currentTimeMillis())
                // As defined in the {@link JobParameter}, only the following types can be parameters: String, Long,
                // Date, and Double. And Date/Long doesn't have enough precision ...
                .addString(FirstAt, firstAt.toString(), false)
                .addString(LastAt, lastAt.toString(), false)
                .addLong(MigrateCodes, migrateCodes ? 1L : 0, false)
                .addLong(MigrateEmbargo, migrateEmbargo ? 1L : 0, false)
                .addLong(BatchSize, (long) batchSize)
                .toJobParameters().getParameters());
    }

    public Instant getFirstAt() {
        return Instant.parse(getString(FirstAt));
    }

    public Instant getLastAt() {
        return Instant.parse(getString(LastAt));
    }

    public boolean getMigrateCodes() {
        return getLong(MigrateCodes) == 1;
    }

    public boolean getMigrateEmbargo() {
        return getLong(MigrateEmbargo) == 1;
    }

    public int getBatchSize() {
        return getLong(BatchSize).intValue();
    }
}

