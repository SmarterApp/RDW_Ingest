package org.opentestsystem.rdw.ingest.migrate.reporting.step;

import org.opentestsystem.rdw.ingest.migrate.reporting.ExecutionParams;
import org.opentestsystem.rdw.ingest.migrate.reporting.MigrateBatch;
import org.springframework.batch.core.scope.context.ChunkContext;
import org.springframework.batch.core.step.tasklet.Tasklet;
import org.springframework.batch.item.ExecutionContext;

/**
 * A helper with common tasklet methods
 */
public abstract class StepTasklet implements Tasklet {


    /**
     * Retrieves {@link MigrateBatch} from the job's {@link ExecutionContext}
     *
     * @param chunkContext the {@link ChunkContext}
     * @return the {@link MigrateBatch}
     */
    protected MigrateBatch getJobBatch(final ChunkContext chunkContext) {
        final MigrateBatch batch = (MigrateBatch) chunkContext.getStepContext().getStepExecution().getJobExecution().getExecutionContext().get(ExecutionParams.batch);
        if (batch == null) throw new IllegalArgumentException("missing migrate batch");
        return batch;
    }

    /**
     * Stores {@link MigrateBatch} into the job's {@link ExecutionContext}
     *
     * @param chunkContext the {@link ChunkContext}
     * @param migrateBatch the {@link MigrateBatch}
     */
    protected void setJobBatch(final ChunkContext chunkContext, final MigrateBatch migrateBatch) {
        chunkContext.getStepContext().getStepExecution().getJobExecution().getExecutionContext().put(ExecutionParams.batch, migrateBatch);
    }
}
