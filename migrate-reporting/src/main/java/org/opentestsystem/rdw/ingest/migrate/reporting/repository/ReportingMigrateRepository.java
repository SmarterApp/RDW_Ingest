package org.opentestsystem.rdw.ingest.migrate.reporting.repository;

import org.opentestsystem.rdw.ingest.migrate.reporting.Migrate;
import org.opentestsystem.rdw.ingest.migrate.reporting.MigrateStatus;

import java.time.Instant;

/**
 * Repository for managing migrate table in the reporting datamart
 */
public interface ReportingMigrateRepository {

    /**
     * @return the last migrate import id, null if no successful migrations
     */
    Instant findLastMigratedAt();

    /**
     * Creates a new migrate entry
     *
     * @param migrate {@link Migrate}
     */
    Migrate create(Migrate migrate);

    /**
     * Delete the migrate with the specified id.
     *
     * @param id migrate id
     */
    void delete(long id);

    /**
     * Update the status of the migrate
     *
     * @param id     the id of the migrate to update
     * @param status the new status
     */
    void updateStatusById(long id, MigrateStatus status);

    /**
     * @return return status of last migrate, may be null if no rows
     */
    MigrateStatus findLastStatus();
}
