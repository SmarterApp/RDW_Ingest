package org.opentestsystem.rdw.ingest.migrate.reporting;


import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;

import java.sql.Date;
import java.time.Instant;

/**
 * Migrate job parameters
 */
class MigrateJobParameters extends JobParameters {

    static final String JobIdentifier = "jobIdentifier";
    static final String FirstAt = "firstAt";
    static final String LastAt = "lastAt";
    static final String MigrateCodes = "migrateCodes";
    static final String BatchSize = "size";

    public MigrateJobParameters(final Instant firstAt, final Instant lastAt, final boolean migrateCodes, final int batchSize) {
        super(new JobParametersBuilder()
                .addLong(JobIdentifier, System.currentTimeMillis())
                // As defined in the {@link JobParameter}, only the following types can be parameters: String, Long, Date, and Double.
                .addDate(FirstAt, Date.from(firstAt), false)
                .addDate(LastAt, Date.from(lastAt), false)
                .addLong(MigrateCodes, migrateCodes ? 1L : 0, false)
                .addLong(BatchSize, (long) batchSize)
                .toJobParameters().getParameters());
    }

    public Instant getFirstAt() {
        return getDate(FirstAt).toInstant();
    }

    public Instant getLastAt() {
        return getDate(LastAt).toInstant();
    }

    public boolean getMigrateCodes() {
        return getLong(MigrateCodes) == 1 ? true : false;
    }

    public int getBatchSize() {
        return getLong(BatchSize).intValue();
    }
}

