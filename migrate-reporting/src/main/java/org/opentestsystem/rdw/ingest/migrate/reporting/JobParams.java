package org.opentestsystem.rdw.ingest.migrate.reporting;


import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;

import java.sql.Date;
import java.time.Instant;

/**
 * Helpers to create/retrieve JobParameters
 */
final class JobParams {

    static final String JobIdentifier = "jobIdentifier";
    static final String FirstAt = "firstAt";
    static final String LastAt = "lastAt";
    static final String MigrateCodes = "migrateCodes";

    public static JobParameters createJobParams(final Instant firstAt, final Instant lastAt, final boolean migrateCodes) {
        return new JobParametersBuilder()
                .addLong(JobIdentifier, System.currentTimeMillis())
                // As defined in the {@link JobParameter}, only the following types can be parameters: String, Long, Date, and Double.
                .addDate(FirstAt, Date.from(firstAt), false)
                .addDate(LastAt, Date.from(lastAt), false)
                .addLong(MigrateCodes, migrateCodes ? 1L : 0, false)
                .toJobParameters();
    }

    public static Instant getFirstAt(final JobParameters jobParameters) {
        return jobParameters.getDate(FirstAt).toInstant();
    }

    public static Instant getLastAt(final JobParameters jobParameters) {
        return jobParameters.getDate(LastAt).toInstant();
    }

    public static boolean getMigrateCodes(final JobParameters jobParameters) {
        return jobParameters.getLong(MigrateCodes) == 1 ? true : false;
    }

    // hide ctor for utility class
    private JobParams() {
    }
}

