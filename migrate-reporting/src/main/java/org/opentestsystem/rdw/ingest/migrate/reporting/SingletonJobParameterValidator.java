package org.opentestsystem.rdw.ingest.migrate.reporting;

import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersInvalidException;
import org.springframework.batch.core.JobParametersValidator;
import org.springframework.batch.core.explore.JobExplorer;

import java.util.Set;


public class SingletonJobParameterValidator implements JobParametersValidator {

    JobExplorer jobExplorer;
    String jobName;

    SingletonJobParameterValidator(JobExplorer jobExplorer, final String jobName) {
        this.jobExplorer = jobExplorer;
        this.jobName = jobName;
    }

    @Override
    public void validate(final JobParameters parameters) throws JobParametersInvalidException {
        Set executions = jobExplorer.findRunningJobExecutions(jobName);
        if (executions != null && executions.size() > 1) {
            //it's running somewhere
            throw new JobParametersInvalidException("the job " + jobName + " is currently running");
        }
    }

}
