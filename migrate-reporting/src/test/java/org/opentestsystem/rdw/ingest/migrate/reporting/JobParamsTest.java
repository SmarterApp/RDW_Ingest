package org.opentestsystem.rdw.ingest.migrate.reporting;

import org.junit.Test;
import org.springframework.batch.core.JobParameter;
import org.springframework.batch.core.JobParameters;

import java.time.Instant;

import static org.assertj.core.api.Assertions.assertThat;
import static org.opentestsystem.rdw.ingest.migrate.reporting.JobParams.createJobParams;

public class JobParamsTest {

    @Test
    public void itShouldSetIdentifyingJobParamAndPreserveCtorValues() {
        final Instant firstAt = Instant.parse("2017-05-18T19:06:34.966Z");
        final Instant lastAt = Instant.parse("2017-05-20T19:06:34.966Z");
        final JobParameters jobParameters = createJobParams(firstAt, lastAt, true);

        final JobParameter jobIdParam = jobParameters.getParameters().get(JobParams.JobIdentifier);
        assertThat(jobIdParam.isIdentifying()).isTrue();
        assertThat(jobIdParam.getValue()).isNotNull();

        assertThat(JobParams.getFirstAt(jobParameters)).isEqualTo(firstAt);
        assertThat(JobParams.getLastAt(jobParameters)).isEqualTo(lastAt);
        assertThat(JobParams.getMigrateCodes(jobParameters)).isTrue();
    }
}