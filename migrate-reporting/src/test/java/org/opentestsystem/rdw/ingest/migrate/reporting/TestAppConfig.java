package org.opentestsystem.rdw.ingest.migrate.reporting;

import org.opentestsystem.rdw.utils.YamlPropertiesConfigurator;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;

import javax.sql.DataSource;

/**
 * This configures an application context that has just enough to test spring batch.
 */
@Configuration
@ComponentScan({"org.opentestsystem.rdw.ingest.migrate", "org.opentestsystem.rdw.ingest.migrate.step", "org.opentestsystem.rdw.ingest.migrate.reporting.listener"})
@Import({MigrateReportingConfiguration.class, YamlPropertiesConfigurator.class})
class TestAppConfig {

    @Autowired
    @Qualifier("batchDataSource")
    DataSource dataSource;

    @Bean(name = "warehouseJdbcTemplate")
    public NamedParameterJdbcTemplate warehouseJdbcTemplate() {
        return new NamedParameterJdbcTemplate(dataSource);
    }

    @Bean(name = "reportingJdbcTemplate")
    public NamedParameterJdbcTemplate reportingJdbcTemplate() {
        return new NamedParameterJdbcTemplate(dataSource);
    }
}
