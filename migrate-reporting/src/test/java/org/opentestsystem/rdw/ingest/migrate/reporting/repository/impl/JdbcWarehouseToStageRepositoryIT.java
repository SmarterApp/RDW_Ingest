package org.opentestsystem.rdw.ingest.migrate.reporting.repository.impl;

import org.junit.Test;
import org.opentestsystem.rdw.ingest.migrate.reporting.RepositoryIT;
import org.opentestsystem.rdw.ingest.migrate.reporting.repository.WarehouseToStageRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.test.context.ContextConfiguration;

import java.util.List;
import java.util.Map;

import static org.assertj.core.api.Assertions.assertThat;
import static org.springframework.test.jdbc.JdbcTestUtils.countRowsInTable;

@ContextConfiguration(classes = JdbcWarehouseToStageRepository.class)
public class JdbcWarehouseToStageRepositoryIT extends RepositoryIT {

    @Autowired
    WarehouseToStageRepository repository;

    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Test
    public void shouldFindWarehouseSubjects() throws Exception {
        final List<Map<String, Object>> subjects = repository.findWarehouseSubjects();
        assertThat(countRowsInTable(jdbcTemplate, "`warehouse-test`.subject")).isEqualTo(subjects.size());
    }

    @Test
    public void shouldFindReportingSubjects() throws Exception {
        final List<Map<String, Object>> subjects = repository.findReportingSubjects();
        assertThat(countRowsInTable(jdbcTemplate, "`reporting-test`.subject")).isEqualTo(subjects.size());
    }

    @Test
    public void shouldFindWarehouseAsmtTypes() throws Exception {
        final List<Map<String, Object>> asmtTypes = repository.findWarehouseAsmtTypes();
        assertThat(countRowsInTable(jdbcTemplate, "`warehouse-test`.asmt_type")).isEqualTo(asmtTypes.size());
    }

    @Test
    public void shouldFindReportingAsmtTypes() throws Exception {
        final List<Map<String, Object>> asmtTypes = repository.findReportingAsmtTypes();
        assertThat(countRowsInTable(jdbcTemplate, "`reporting-test`.asmt_type")).isEqualTo(asmtTypes.size());
    }

    @Test
    public void shouldFindWarehouseSubjectClaimScores() throws Exception {
        final List<Map<String, Object>> subjectClaimScores = repository.findWarehouseSubjectClaimScores();
        assertThat(countRowsInTable(jdbcTemplate, "`warehouse-test`.subject_claim_score"))
                .isEqualTo(subjectClaimScores.size());
    }

    @Test
    public void shouldFindReportingSubjectClaimScores() throws Exception {
        final List<Map<String, Object>> subjectClaimScores = repository.findReportingSubjectClaimScores();
        assertThat(countRowsInTable(jdbcTemplate, "`reporting-test`.subject_claim_score"))
                .isEqualTo(subjectClaimScores.size());
    }

}