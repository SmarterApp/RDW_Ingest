package org.opentestsystem.rdw.ingest.migrate.reporting.step;

import org.junit.Test;
import org.opentestsystem.rdw.ingest.migrate.reporting.MigrateBatch;
import org.opentestsystem.rdw.ingest.migrate.reporting.SpringBatchStepIT;
import org.springframework.batch.core.ExitStatus;
import org.springframework.batch.core.JobExecution;

import static com.google.common.collect.Lists.newArrayList;
import static org.assertj.core.api.Assertions.assertThat;
import static org.opentestsystem.rdw.ingest.migrate.reporting.MigrateReportingConfiguration.stepReportingName;


public class ReportingIT extends SpringBatchStepIT {

    @Test
    public void testStep() {
        getStepExecutionContext().put("batch", new MigrateBatch(1, 1, newArrayList()));

        final JobExecution jobExecution = launchStep(stepReportingName, true);
        assertThat(jobExecution.getExitStatus().getExitCode()).isEqualTo(ExitStatus.COMPLETED.getExitCode());
    }

    @Test
    public void testStepWithError() {
        getStepExecutionContext().put("batch", null);

        final JobExecution jobExecution = launchStep(stepReportingName, true);
        assertThat(jobExecution.getExitStatus().getExitCode()).isEqualTo("test_failure");
    }
}
