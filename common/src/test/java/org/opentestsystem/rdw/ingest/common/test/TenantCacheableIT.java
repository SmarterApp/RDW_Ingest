package org.opentestsystem.rdw.ingest.common.test;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cache.Cache;
import org.springframework.cache.CacheManager;

import org.opentestsystem.rdw.multitenant.cache.TenantCacheable;
import org.opentestsystem.rdw.multitenant.cache.TenantKeyGenerator;

/**
 * Helper base class for tests that use {@link TenantCacheable} and want to check caching.
 */
@CachingTest
public abstract class TenantCacheableIT {

    @Autowired
    protected CacheManager cacheManager;

    @Autowired
    protected TenantKeyGenerator tenantKeyGenerator;

    /**
     * Helper to get the tenant-qualified cache.
     *
     * @param cache cache name
     * @param methodName method name, e.g. "findIdByCode"
     * @param params method parameters, e.g. "1-LT"
     * @return cached value
     */
    protected Cache.ValueWrapper getCachedValue(final String cache, final String methodName, final Object... params) {
        final String key = (String)tenantKeyGenerator.generate(methodName, params);
        return cacheManager.getCache(cache).get(key);
    }
}
