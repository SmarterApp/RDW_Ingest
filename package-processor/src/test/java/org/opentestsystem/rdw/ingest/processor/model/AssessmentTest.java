package org.opentestsystem.rdw.ingest.processor.model;

import org.junit.Test;

import java.util.ArrayList;
import java.util.Arrays;

import static org.assertj.core.api.Assertions.assertThat;

/**
 * Unit test for the Assessment model
 */
public class AssessmentTest {
    @Test
    public void itShouldCompareAssessments() {
        final Assessment.Builder builder = Assessment.builder()
                .name("name")
                .naturalId("id")
                .academicYear(2017)
                .gradeId(3)
                .label("label")
                .subjectId(5)
                .typeId(1)
                .version("version")
                .cutPoints(new Double[]{1.3e1,2.4e1,3.3e3,4.4e4})
                .maxScore(2000.0)
                .minScore(1000.0);

        final Assessment assessment = builder.build();
        final Assessment sameAssessment = builder.build();

        assertThat(assessment).isEqualTo(sameAssessment);
        assertThat(assessment.hashCode()).isEqualTo(sameAssessment.hashCode());

        assertThat(sameAssessment).isNotEqualTo(null);

        Assessment otherAssessment = builder.name("new name").build();
        assertThat(assessment).isNotEqualTo(otherAssessment);
        assertThat(assessment.hashCode()).isNotEqualTo(otherAssessment.hashCode());

        otherAssessment = builder.name("name").naturalId("new id").build();
        assertThat(assessment).isNotEqualTo(otherAssessment);
        assertThat(assessment.hashCode()).isNotEqualTo(otherAssessment.hashCode());

        otherAssessment = builder.naturalId("id").academicYear(2000).build();
        assertThat(assessment).isNotEqualTo(otherAssessment);
        assertThat(assessment.hashCode()).isNotEqualTo(otherAssessment.hashCode());
    }

    /**
     * Required parameters are naturalId, cutPoints, maxScore, minScore, gradeId, subjectId, typeId
     * However, in usage in the Package Processor, gradeId, subjectId, and typeId are validated
     * against the database before they are set in the builder. If they aren't found, then building stops.
     */
    @Test(expected = NullPointerException.class)
    public void itShouldNotAllowCertainNullParameters() {
        final Assessment.Builder builder = Assessment.builder()
                .naturalId("id")
                .name("name")
                .academicYear(2017)
                .gradeId(3)
                .label("label")
                .version("version")
                .cutPoints(new Double[]{1.3e1,2.4e1,3.3e3,4.4e4})
                .maxScore(2000.0)
                .minScore(1000.0);

        builder.build();
    }

    /**
     * Optional parameters are name, version, label
     */
    @Test
    public void itShouldAllowCertainNullParameters() {
        final Assessment.Builder builder = Assessment.builder()
                .naturalId("id")
                .academicYear(2017)
                .gradeId(3)
                .subjectId(5)
                .typeId(1)
                .version("version")
                .cutPoints(new Double[]{1.3e1,2.4e1,3.3e3,4.4e4})
                .maxScore(2000.0)
                .minScore(1000.0);

        builder.build();
    }
}
