package org.opentestsystem.rdw.ingest.processor.service.impl.validator;

import org.opentestsystem.rdw.common.model.subject.Standard;
import org.opentestsystem.rdw.common.model.subject.Subject;
import org.opentestsystem.rdw.ingest.processor.model.SubjectValidationContext;
import org.opentestsystem.rdw.ingest.processor.service.SubjectValidator;
import org.springframework.stereotype.Component;

import java.util.Set;

import static com.google.common.collect.Sets.newHashSet;

/**
 * This validator validates {@link Standard} models within a Subject.
 */
@Component
class StandardValidator implements SubjectValidator {

    @Override
    public void validate(final SubjectValidationContext context, final Subject subject) {
        if (subject.getStandards() == null) return;

        final Set<String> standardCodes = newHashSet();
        context.push("Standards");
        for (final Standard standard : subject.getStandards()) {
            final String code = standard.getCode();
            if (!standardCodes.add(code)) {
                context.failure("Duplicate standard code found: " + code);
            }
        }
        context.pop();
    }

}
