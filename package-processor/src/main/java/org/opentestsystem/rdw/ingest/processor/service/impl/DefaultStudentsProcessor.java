package org.opentestsystem.rdw.ingest.processor.service.impl;

import org.opentestsystem.rdw.ingest.processor.model.Student;
import org.opentestsystem.rdw.ingest.processor.repository.StudentRepository;
import org.opentestsystem.rdw.ingest.processor.service.StudentsProcessor;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
class DefaultStudentsProcessor implements StudentsProcessor {
    private static final Logger logger = LoggerFactory.getLogger(DefaultStudentsProcessor.class);
    private final StudentRepository repository;
    private final StudentParser parser;

    @Autowired
    public DefaultStudentsProcessor(final StudentRepository repository, final StudentParser parser) {
        this.repository = repository;
        this.parser = parser;
    }

    @Override
    public String process(final byte[] payload, final long importId) {

        final List<Student> students = parser.parse(payload);

        repository.update(students, importId);

        final String message = "Students updated: " + students.size();
        logger.info(message);

        return message;
    }
}
