package org.opentestsystem.rdw.ingest.processor.service.impl.validator;

import org.opentestsystem.rdw.common.model.subject.Subject;
import org.opentestsystem.rdw.common.model.subject.Trait;
import org.opentestsystem.rdw.ingest.processor.service.SubjectValidator;
import org.opentestsystem.rdw.utils.LocationAwareErrorCollector;
import org.springframework.stereotype.Component;

import java.util.Set;

import static com.google.common.collect.Sets.newHashSet;

/**
 * This validator validates {@link Trait} models within a Subject.
 */
@Component
class TraitValidator implements SubjectValidator {

    @Override
    public void validate(final LocationAwareErrorCollector context, final Subject subject) {
        if (subject.getTraits() == null) return;

        final Set<String> codes = newHashSet();
        context.push("Traits");
        for (final Trait trait : subject.getTraits()) {
            final String code = trait.getCode();
            if (!codes.add(code)) {
                context.failure("Duplicate trait code found: " + code);
            }
        }
        context.pop();
    }
}
