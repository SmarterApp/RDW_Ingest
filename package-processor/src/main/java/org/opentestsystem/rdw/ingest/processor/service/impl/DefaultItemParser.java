package org.opentestsystem.rdw.ingest.processor.service.impl;

import org.apache.commons.validator.routines.FloatValidator;
import org.apache.commons.validator.routines.IntegerValidator;
import org.apache.commons.csv.CSVRecord;
import org.opentestsystem.rdw.ingest.processor.model.Item;
import org.opentestsystem.rdw.ingest.processor.service.ItemParser;
import org.springframework.stereotype.Service;

/**
 * ItemParserImpl - parses and validates item parameters from package
 */
@Service
public class DefaultItemParser implements ItemParser {
    private IntegerValidator intValidator;
    private FloatValidator floatValidator;

    public DefaultItemParser() {
        this.intValidator = IntegerValidator.getInstance();
        this.floatValidator = FloatValidator.getInstance();
    }

    @Override
    public Item parse(CSVRecord record) {
        return Item.builder()
                .itemKey(record.get("ItemId"))
                .claimCode(record.get("Claim"))
                .target(record.get("Target"))
                .allowCalculator(record.get("AllowCalculator").equals("Y"))
                .difficulty(floatValidator.validate(record.get("avg_b")))
                .dok(intValidator.validate(record.get("DOK")))
                .mathPractice(intValidator.validate(record.get("MathematicalPractice")))
                .build();
    }
}
