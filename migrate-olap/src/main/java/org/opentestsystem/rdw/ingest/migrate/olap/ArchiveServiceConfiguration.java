package org.opentestsystem.rdw.ingest.migrate.olap;

import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.cloud.context.config.annotation.RefreshScope;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import org.opentestsystem.rdw.archive.ArchivePropertiesResolver;
import org.opentestsystem.rdw.archive.ArchivePropertiesRoot;
import org.opentestsystem.rdw.archive.ArchiveServiceTenantDynamicRouter;
import org.opentestsystem.rdw.multitenant.TenantKeyResolver;

@Configuration
public class ArchiveServiceConfiguration {

    @Bean
    @ConfigurationProperties("archive")
    @RefreshScope
    ArchivePropertiesRoot archivePropertiesRoot() {
        return new ArchivePropertiesRoot();
    }

    @Bean
    @RefreshScope
    ArchivePropertiesResolver archivePropertiesResolver(final TenantKeyResolver tenantKeyResolver,
                                                        final ArchivePropertiesRoot archivePropertiesRoot) {
        return new ArchivePropertiesResolver(tenantKeyResolver, archivePropertiesRoot);
    }

    @Bean
    @RefreshScope
    ArchiveServiceTenantDynamicRouter archiveService(final ArchivePropertiesResolver archivePropertiesResolver,
                                                     final TenantKeyResolver tenantKeyResolver) {
        return new ArchiveServiceTenantDynamicRouter(archivePropertiesResolver, tenantKeyResolver);
    }
}
