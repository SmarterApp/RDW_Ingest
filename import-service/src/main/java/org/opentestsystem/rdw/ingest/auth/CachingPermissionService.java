package org.opentestsystem.rdw.ingest.auth;

import org.opentestsystem.rdw.security.service.PermissionService;
import org.opentestsystem.rdw.security.service.PermissionServiceException;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.context.annotation.Primary;
import org.springframework.stereotype.Service;

import java.util.Collection;
import java.util.Map;

/**
 * Wrap the basic permission service to cache the results since role/permissions don't change often.
 */
@Primary
@Service
class CachingPermissionService implements PermissionService {

    private final PermissionService permissionService;

    public CachingPermissionService(@Qualifier("basicPermissionService") final PermissionService permissionService) {
        this.permissionService = permissionService;
    }

    @Cacheable("permissionsByRole")
    public Map<String, Collection<String>> getPermissionsByRole() throws PermissionServiceException {
        return permissionService.getPermissionsByRole();
    }
}

