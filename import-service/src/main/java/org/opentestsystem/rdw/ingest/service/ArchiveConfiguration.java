package org.opentestsystem.rdw.ingest.service;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * Configuration for archive service
 */
@Configuration
public class ArchiveConfiguration {

    /**
     * Create {@link ArchiveService} based on configuration setting of "archive.root".
     *
     * @param archiveRoot configured archive root
     * @return new created {@link ArchiveService}
     */
    @Bean
    public ArchiveService archiveService(@Value("${archive.root:file:///tmp/}") final String archiveRoot) {
        // this could be more elegant (e.g. use a Condition) but for now ...
        if (LocalArchiveService.validRoot(archiveRoot)) {
            return new LocalArchiveService(archiveRoot);
        }
        if (S3ArchiveService.validRoot(archiveRoot)) {
            return new S3ArchiveService(archiveRoot);
        }
        return null;
    }
}
