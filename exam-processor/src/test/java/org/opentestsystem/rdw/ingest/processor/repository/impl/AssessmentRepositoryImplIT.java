package org.opentestsystem.rdw.ingest.processor.repository.impl;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.opentestsystem.rdw.ingest.processor.model.Assessment;
import org.opentestsystem.rdw.ingest.processor.repository.AssessmentRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.jdbc.Sql;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.transaction.annotation.Transactional;

import static org.assertj.core.api.Assertions.assertThat;

@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
public class AssessmentRepositoryImplIT {

    @Autowired
    private AssessmentRepository repository;

    @Test
    @Sql(statements = "INSERT INTO asmt (id, natural_id, grade_id, type_id, subject_id, academic_year, name, label, version) VALUES " +
            "(22, 'exam natural id', 4, 2, 1, 2016, 'SBAC-IAB-FIXED-G4M-OA-MATH-4', 'MTH IAB G4 OperationsAlgebraicThinking', '9835');")
    public void itShouldFindAssessmentByNaturalId() {
        final Assessment assessment = repository.findOneByNaturalId("exam natural id");

        assertThat(assessment.getId()).isEqualTo(22);
        assertThat(assessment.getAcademicYear()).isEqualTo(2016);
        assertThat(assessment.getGradeId()).isEqualTo(4);
        assertThat(assessment.getLabel()).isEqualTo("MTH IAB G4 OperationsAlgebraicThinking");
        assertThat(assessment.getName()).isEqualTo("SBAC-IAB-FIXED-G4M-OA-MATH-4");
        assertThat(assessment.getNaturalId()).isEqualTo("exam natural id");
        assertThat(assessment.getSubjectId()).isEqualTo(1);
        assertThat(assessment.getTypeId()).isEqualTo(2);
        assertThat(assessment.getVersion()).isEqualTo("9835");

    }

    @Test
    public void itShouldCreateAssessment() {
        final Assessment assessment = repository.create(Assessment.builder()
                .withNaturalId("exam natural id")
                .withGradeId(7)
                .withTypeId(2)
                .withSubjectId(1)
                .withAcademicYear(2016)
                .withName("SBAC-IAB-FIXED-G4M-OA-MATH-4")
                .withLabel("MTH IAB G4 OperationsAlgebraicThinking")
                .withVersion("9835")
                .build());

        assertThat(assessment.getId()).isNotNull();
        assertThat(assessment.getAcademicYear()).isEqualTo(2016);
        assertThat(assessment.getGradeId()).isEqualTo(7);
        assertThat(assessment.getLabel()).isEqualTo("MTH IAB G4 OperationsAlgebraicThinking");
        assertThat(assessment.getName()).isEqualTo("SBAC-IAB-FIXED-G4M-OA-MATH-4");
        assertThat(assessment.getNaturalId()).isEqualTo("exam natural id");
        assertThat(assessment.getSubjectId()).isEqualTo(1);
        assertThat(assessment.getTypeId()).isEqualTo(2);
        assertThat(assessment.getVersion()).isEqualTo("9835");
    }

}