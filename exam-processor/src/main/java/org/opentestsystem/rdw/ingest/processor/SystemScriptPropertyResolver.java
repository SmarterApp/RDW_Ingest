package org.opentestsystem.rdw.ingest.processor;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Primary;
import org.springframework.stereotype.Component;

import java.util.HashMap;
import java.util.Map;
import org.opentestsystem.rdw.common.model.trt.XmlUtils;
import org.opentestsystem.rdw.ingest.processor.repository.AssessmentRepository;
import org.opentestsystem.rdw.ingest.processor.repository.EthnicityRepository;
import org.opentestsystem.rdw.ingest.processor.repository.ExamRepository;
import org.opentestsystem.rdw.ingest.processor.repository.GenderRepository;
import org.opentestsystem.rdw.ingest.processor.repository.SchoolRepository;
import org.opentestsystem.rdw.ingest.processor.repository.StudentRepository;
import org.opentestsystem.rdw.ingest.processor.repository.SubjectRepository;
import org.opentestsystem.rdw.ingest.processor.service.ExamineeProcessor;
import org.opentestsystem.rdw.ingest.processor.service.StudentExamProcessor;
import org.opentestsystem.rdw.ingest.processor.service.util.TrtUtils;
import org.opentestsystem.rdw.ingest.script.PropertyResolver;

/**
 * Implementation of PropertyResolver, which makes some utility classes and some Spring beans
 * available to the system scripts.
 */
@Component
@Primary
public class SystemScriptPropertyResolver implements PropertyResolver {
    private static final Map<String,Class<?>> UTILITY_CLASSES = new HashMap<>();

    static {
        UTILITY_CLASSES.put("xmlUtils", XmlUtils.class);
        UTILITY_CLASSES.put("trtUtils", TrtUtils.class);
    }

    private final Map<String,Object> resolvers = new HashMap<>(UTILITY_CLASSES);

    @Autowired
    public SystemScriptPropertyResolver(
            final AssessmentRepository assessmentRepository,
            final EthnicityRepository ethnicityRepository,
            final ExamRepository examRepository,
            final GenderRepository genderRepository,
            final SchoolRepository schoolRepository,
            final StudentRepository studentRepository,
            final SubjectRepository subjectRepository,
            final ExamineeProcessor examineeProcessor,
            final StudentExamProcessor studentExamProcessor) {

        resolvers.put("assessmentRepository", assessmentRepository);
        resolvers.put("ethnicityRepository", ethnicityRepository);
        resolvers.put("examRepository", examRepository);
        resolvers.put("genderRepository", genderRepository);
        resolvers.put("schoolRepository", schoolRepository);
        resolvers.put("studentRepository", studentRepository);
        resolvers.put("subjectRepository", subjectRepository);

        resolvers.put("studentExamProcessor", studentExamProcessor);
        resolvers.put("examineeProcessor", examineeProcessor);
    }

    @Override
    public Object resolveProperty(final String name) {
        return resolvers.get(name);
    }
}
