package org.opentestsystem.rdw.ingest.processor.model;

import java.util.Date;
import java.util.List;

import static com.google.common.collect.Lists.newArrayList;
import static org.opentestsystem.rdw.ingest.processor.model.CodifiedField.UndefinedValue;


/**
 * This class represents common attributes share by all types of exams
 */
public abstract class AnyExam {
    //TODO: add support for accessibility accommodations
    private Date completedAt;
    private long assessmentId;
    private String asmtVersion;
    private int opportunity;
    private int completeness;
    private int administrationConditionId;
    private String status;
    private String sessionId;
    private StudentExamAttributes studentExamAttributes;
    private List<ExamItem> examItems;
    private Double scaleScore;
    private Double scaleScoreStdErr;

    public Double getScaleScore() {
        return scaleScore;
    }

    public Double getScaleScoreStdErr() {
        return scaleScoreStdErr;
    }

    public Date getCompletedAt() {
        return completedAt;
    }

    public long getAssessmentId() {
        return assessmentId;
    }

    public String getAsmtVersion() {
        return asmtVersion;
    }

    public int getOpportunity() {
        return opportunity;
    }

    public int getCompleteness() {
        return completeness;
    }

    public int getAdministrationConditionId() {
        return administrationConditionId;
    }

    public String getStatus() {
        return status;
    }

    public String getSessionId() {
        return sessionId;
    }

    public StudentExamAttributes getStudentExamAttributes() {
        return studentExamAttributes;
    }

    public List<ExamItem> getExamItems() {
        return examItems == null ? newArrayList() : examItems;
    }


    /**
     * The builder for the {@link AnyExam}
     */
    @SuppressWarnings("unchecked")
    public static abstract class Builder<B extends Builder<B, E>, E extends AnyExam> {
        private Date completedAt;
        private long assessmentId;
        private String asmtVersion;
        private int opportunity;
        private int completeness = UndefinedValue;
        private int administrationConditionId = UndefinedValue;
        private String status;
        private String sessionId;
        private StudentExamAttributes studentExamAttributes;
        private List<ExamItem> examItems;
        private Double scaleScore;
        private Double scaleScoreStdErr;

        public E build() {
            final E exam = createExam();
            return (E) init(exam);
        }

        private AnyExam init(final AnyExam exam) {
            exam.administrationConditionId = administrationConditionId;
            exam.completedAt = completedAt;
            exam.assessmentId = assessmentId;
            exam.asmtVersion = asmtVersion;
            exam.opportunity = opportunity;
            exam.completeness = completeness;
            exam.administrationConditionId = administrationConditionId;
            exam.status = status;
            exam.sessionId = sessionId;
            exam.studentExamAttributes = studentExamAttributes;
            exam.scaleScore = scaleScore;
            exam.scaleScoreStdErr = scaleScoreStdErr;
            exam.examItems = examItems;
            return exam;
        }

        protected abstract E createExam();

        public B withCompletedAt(final Date completedAt) {
            this.completedAt = completedAt;
            return (B) this;
        }

        public B withAssessmentId(final long assessmentId) {
            this.assessmentId = assessmentId;
            return (B) this;
        }

        public B withAsmtVersion(final String asmtVersion) {
            this.asmtVersion = asmtVersion;
            return (B) this;
        }

        public B withOpportunity(final int opportunity) {
            this.opportunity = opportunity;
            return (B) this;
        }

        public B withCompleteness(final int completeness) {
            this.completeness = completeness;
            return (B) this;
        }

        public B withScaleScore(final Double scaleScore) {
            this.scaleScore = scaleScore;
            return (B) this;
        }

        public B withScaleScoreStdErr(final Double scaleScoreStdErr) {
            this.scaleScoreStdErr = scaleScoreStdErr;
            return (B) this;
        }

        public B withAdministrationConditionId(final int administrationConditionId) {
            this.administrationConditionId = administrationConditionId;
            return (B) this;
        }

        public B withStatus(final String status) {
            this.status = status;
            return (B) this;
        }

        public B withSessionId(final String sessionId) {
            this.sessionId = sessionId;
            return (B) this;
        }

        public B withStudentAttributes(final StudentExamAttributes studentExamAttributes) {
            this.studentExamAttributes = studentExamAttributes;
            return (B) this;
        }

        public B withExamItems(final List<ExamItem> examItems) {
            this.examItems = examItems;
            return (B) this;
        }
    }
}
