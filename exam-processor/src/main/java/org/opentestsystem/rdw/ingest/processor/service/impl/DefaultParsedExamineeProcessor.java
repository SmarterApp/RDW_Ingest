package org.opentestsystem.rdw.ingest.processor.service.impl;

import org.opentestsystem.rdw.ingest.processor.model.StudentExamAttributes;
import org.opentestsystem.rdw.ingest.processor.repository.StudentRepository;
import org.opentestsystem.rdw.ingest.processor.service.ParsedExaminee;
import org.opentestsystem.rdw.ingest.processor.service.ParsedExamineeProcessor;
import org.opentestsystem.rdw.ingest.processor.service.SchoolService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class DefaultParsedExamineeProcessor implements ParsedExamineeProcessor {

    private final SchoolService schoolService;
    private final StudentRepository studentRepository;

    @Autowired
    public DefaultParsedExamineeProcessor(final SchoolService schoolService,
                                          final StudentRepository studentRepository) {
        this.schoolService = schoolService;
        this.studentRepository = studentRepository;
    }

    @Override
    public StudentExamAttributes process(final ParsedExaminee parsedExaminee) {

        final int schoolId = schoolService.upsert(parsedExaminee.getSchool());
        final long studentId = studentRepository.upsert(parsedExaminee.getStudent());

        return parsedExaminee.getStudentExamAttributeBuilder()
                .withResponsibleSchoolId(schoolId)
                .withStudentId(studentId)
                .build();

    }
}
