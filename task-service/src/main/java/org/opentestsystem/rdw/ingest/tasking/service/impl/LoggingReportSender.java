package org.opentestsystem.rdw.ingest.tasking.service.impl;

import com.google.common.io.CountingInputStream;
import org.opentestsystem.rdw.ingest.tasking.service.ReportSender;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.io.InputStream;

/**
 * A {@link ReportSender} that simply logs that a report was submitted.
 * Intended for dev/test use only.
 */
public class LoggingReportSender implements ReportSender {
    private static final Logger logger = LoggerFactory.getLogger(LoggingReportSender.class);

    @Override
    public void sendReport(final InputStream is, final String filename) {
        // count bytes (this is an effort to exercise the input stream when in dev mode)
        try (final CountingInputStream cis = new CountingInputStream(is)) {
            final byte[] buffer = new byte[4096];
            while (-1 != cis.read(buffer)) ;
            logger.info("**** DEV ONLY Fake Report Sender **** >> sent report {} ({} bytes)", filename, cis.getCount());
        } catch (final IOException e) {
            logger.warn("Error reading report", e);
        }
    }

    @Override
    public boolean isAvailable() {
        return true;
    }
}
