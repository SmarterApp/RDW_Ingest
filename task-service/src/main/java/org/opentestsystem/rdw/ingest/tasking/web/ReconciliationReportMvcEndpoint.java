package org.opentestsystem.rdw.ingest.tasking.web;

import org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

/**
 * MVC adapter for reconciliation report end-point.
 * <p>
 * Allows POSTing to an actuator end-point to trigger the reconciliation report with optional tenant id:<pre>
 * POST host:8008/reconciliationReport?tenantId=CA
 * </pre>
 * </p>
 */
public class ReconciliationReportMvcEndpoint extends EndpointMvcAdapter {
    private final ReconciliationReportEndpoint delegate;

    public ReconciliationReportMvcEndpoint(final ReconciliationReportEndpoint delegate) {
        super(delegate);
        this.delegate = delegate;
    }

    @PostMapping()
    @ResponseBody
    public Object migrate(@RequestParam(required = false) final String tenantId) {
        if (!getDelegate().isEnabled()) {
            // Shouldn't happen - MVC endpoint shouldn't be registered when delegate's disabled
            return getDisabledResponse();
        }
        return delegate.report(tenantId) + "\n";
    }
}
