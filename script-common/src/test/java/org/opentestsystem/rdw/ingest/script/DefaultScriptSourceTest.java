package org.opentestsystem.rdw.ingest.script;

import org.junit.Before;
import org.junit.Test;

import org.opentestsystem.rdw.ingest.script.impl.DefaultScriptSource;

import static org.assertj.core.api.Assertions.assertThat;

public class DefaultScriptSourceTest {

    private DefaultScriptSource scriptSource;

    @Before
    public void createScriptSource() {
        scriptSource = new DefaultScriptSource();
    }

    @Test
    public void itShouldLoadTheScriptBase() {
        assertThat(scriptSource.loadScriptBaseClass())
                .contains("DSLScriptBase")
                .contains("PipelineScript");
    }

    @Test
    public void itShouldLoadPipelineDefinition() {
        final PipelineDefinition pipelineDefinition =
                scriptSource.loadPipelineDefinition("test_pipeline", "1.0");
        assertThat(pipelineDefinition.getName()).isEqualTo("test_pipeline");
        assertThat(pipelineDefinition.getVersion()).isEqualTo("1.0");
    }

    @Test
    public void isShouldLoadScript() {
        final VersionedResource node = new VersionedResource("exam_script", "", ResourceType.USER_NODE);
        assertThat(scriptSource.loadScript(node).getCode()).startsWith("enable 'xml'");
    }
}
