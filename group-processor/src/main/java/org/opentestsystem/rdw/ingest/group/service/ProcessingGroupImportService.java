package org.opentestsystem.rdw.ingest.group.service;

/**
 * Implementations of this interface are responsible for creating and importing student groups
 * while processing a group definition import.
 *
 * The service is designed to be executed as an ordered flow to support transaction boundaries:
 * <ol>
 *     <li>{@link #createImports(long)}</li>
 *     <li>{@link #insertMissingGroups(long)}</li>
 *     <li>{@link #updateDeletedGroups(long)}</li>
 *     <li>{@link #updateModifiedGroups(long)}</li>
 *     <li>{@link #updateModifiedGroupUsers(long)}</li>
 *     <li>{@link #updateModifiedGroupStudents(long)}</li>
 *     <li>{@link #triggerImport(long)}</li>
 * </ol>
 */
public interface ProcessingGroupImportService {

    /**
     * Create and register an import for any groups that:
     * <ol>
     *     <li>do not currently exist in the system</li>
     *     <li>have a change in student membership</li>
     *     <li>have a change in authorized users</li>
     *     <li>have a change in subject</li>
     *     <li>have been deleted</li>
     * </ol>
     * In the interests of performance there will be one import per school.
     *
     * @param batchId The batch id
     */
    void createImports(long batchId);

    /**
     * Insert missing group records into the student_group table.
     *
     * @param batchId The batch id
     */
    void insertMissingGroups(long batchId);

    /**
     * Update existing, referenced deleted group records to mark
     * them as not deleted.
     *
     * @param batchId The batch id
     */
    void updateDeletedGroups(long batchId);

    /**
     * Update modified groups.
     *
     * @param batchId The batch id
     */
    void updateModifiedGroups(long batchId);

    /**
     * Update the authenticated users for ingested groups.
     *
     * @param batchId The batch id
     */
    void updateModifiedGroupUsers(long batchId);

    /**
     * Update the student membership for ingested groups.
     *
     * @param batchId The batch id
     */
    void updateModifiedGroupStudents(long batchId);

    /**
     * Trigger the created imports and clean up.
     *
     * @param batchId The batch id
     */
    void triggerImport(long batchId);
}
