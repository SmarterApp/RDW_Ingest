package org.opentestsystem.rdw.ingest.group.repository;

import org.opentestsystem.rdw.ingest.common.model.ImportStatus;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.stereotype.Repository;

/**
 * JDBC-backed implementation of a StudentGroupBatchRepository
 */
@Repository
public class JdbcStudentGroupBatchRepository implements StudentGroupBatchRepository {

    private final NamedParameterJdbcTemplate template;

    @Value("${sql.update-batch}")
    public String updateBatch;

    @Autowired
    public JdbcStudentGroupBatchRepository(final NamedParameterJdbcTemplate template) {
        this.template = template;
    }

    @Override
    public void updateBatch(final long batchId, final ImportStatus status) {
        updateBatch(batchId, status, null);
    }

    @Override
    public void updateBatch(final long batchId, final ImportStatus status, final String message) {
        template.update(
                updateBatch,
                new MapSqlParameterSource()
                    .addValue("batch_id", batchId)
                    .addValue("status", status.getValue())
                    .addValue("message", message));
    }
}
