package org.opentestsystem.rdw.ingest.group.repository;

import com.google.common.collect.ImmutableMap;
import org.opentestsystem.rdw.ingest.common.model.ImportStatus;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.stereotype.Repository;

/**
 * JDBC-backed implementation of a StudentGroupBatchRepository
 */
@Repository
public class JdbcStudentGroupBatchRepository implements StudentGroupBatchRepository {

    private final NamedParameterJdbcTemplate template;

    @Value("${sql.update-batch}")
    public String updateBatch;

    @Autowired
    public JdbcStudentGroupBatchRepository(final NamedParameterJdbcTemplate template) {
        this.template = template;
    }

    @Override
    public void updateBatchStatus(final long batchId, final ImportStatus status, final String message) {
        template.update(
                updateBatch,
                ImmutableMap.of(
                        "batch_id", batchId,
                        "status", status.getValue(),
                        "message", message));
    }
}
