package org.opentestsystem.rdw.ingest.group.service;

/**
 * Implementations of this interface are responsible for creating and importing students
 * while processing a group definition import.
 * NOTE that this service is designed to be iteratively by school followed by a final cleanup call
 *
 * The service is designed to be executed as an ordered flow to support transaction boundaries:
 * <ol>
 *     <li>{@link #createImports(long, int)}</li>
 *     <li>{@link #insertMissingStudents(long, int)}</li>
 *     <li>{@link #updateDeletedStudents(long, int)}</li>
 *     <li>{@link #triggerImport(long, int)}</li>
 *     <li>After looping through schools: {@link #cleanupBatch(long)}</li>
 * </ol>
 */
public interface ProcessingUserImportService {

    /**
     * Create and register an import for any students referenced by a Group
     * that:
     * <ol>
     *     <li>do not currently exist in the system</li>
     *     <li>have been deleted</li>
     * </ol>
     * In the interests of performance there will be one import per school.
     *
     * @param batchId The batch id
     */
    void createImports(long batchId, int school_id);

    /**
     * Insert missing student records into the student table.
     *
     * @param batchId The batch id
     */
    void insertMissingStudents(long batchId, int school_id);

    /**
     * Update existing, referenced deleted student records to mark
     * them as not deleted.
     *
     * @param batchId The batch id
     */
    void updateDeletedStudents(long batchId, int school_id);

    /**
     * Trigger the created imports and update student references.
     *
     * @param batchId The batch id
     */
    void triggerImport(long batchId, int school_id);

    /**
     * Clean up interim import records.
     *
     * @param batchId The batch id
     */
    void cleanupBatch(long batchId);
}
